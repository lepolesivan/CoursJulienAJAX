(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8865],{4610:function(e,r,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/me",function(){return i(9724)}])},8431:function(e,r,i){"use strict";i.d(r,{x:function(){return u}});var a=i(2322),o=i(9604),n=i(5598),s=i(3196),t=i.n(s),c=i(7841),l=i(8329),d=i(3125),u=function(e){var r=e.icon,i=e.showProBadge,s=e.title,u=e.subtitle;return(0,a.jsx)(d.E.div,{className:t().innerPageHeader,initial:{opacity:0},exit:{opacity:0},animate:{opacity:1},children:(0,a.jsxs)(n.VStack,{children:[r?(0,a.jsx)(o.J,{size:"32",marginRight:"0",name:r,color:"var(--clr-brand)"}):null,i?(0,a.jsx)(l.Z,{height:"24"}):null,(0,a.jsx)(c.x,{size:4,weight:"600",mono:!1,tag:"h1",appearance:"primary",children:s}),(0,a.jsx)("div",{style:{maxWidth:"72ch"},children:(0,a.jsx)(c.x,{size:1,weight:"500",mono:!1,tag:"p",letterSpacing:"0.3px",appearance:"secondary",lineHeight:"1.5",align:"center",children:u})})]})})}},5416:function(e,r,i){"use strict";i.d(r,{s:function(){return s}});var a=i(2322),o=i(8033),n=i.n(o),s=function(e){var r=e.classes,i=void 0===r?"":r,o=e.padding,s=void 0===o?"2rem":o,t=e.fullWidth,c=void 0!==t&&t,l=e.fullHeight,d=void 0!==l&&l,u=e.glowing,h=void 0!==u&&u,f=e.topFocus,g=void 0!==f&&f,p=e.onlyBorder,m=void 0!==p&&p,v=e.children;return(0,a.jsx)("div",{style:{padding:s,width:c?"100%":"auto",height:d?"100%":"auto"},className:"".concat(n().panel," ").concat(i," ").concat(h&&n().panelGlowing," ").concat(g&&n().panelTopFocus," ").concat(m&&n().panelOnlyBorder),children:v})}},9724:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return k}});var a=i(6383),o=i(2322),n=i(2784),s=i(7729),t=i.n(s),c=i(9097),l=i.n(c),d=i(5632),u=i(7500),h=i(7037),f=i(9241),g=i(1893),p=function(e){var r=e.className,i=void 0===r?"":r,a=e.ref,n=e.disabled,s=e.onChange,t=e.value,c=e.children;return(0,o.jsx)("div",{className:"select ".concat(i),children:(0,o.jsx)("select",{ref:a,disabled:n,onChange:s,value:t,children:c})})},m=i(5598),v=i(2367),x=i(1251),y=i(7414),j=i(865),S=i(6670),H=i(7274);function b(e){var r=e.columns,i=e.data,a=e.initialState,n=e.classes,s=(0,H.useTable)({columns:r,data:i,initialState:a},H.useSortBy),t=s.getTableProps,c=s.getTableBodyProps,l=s.headerGroups,d=s.rows,u=s.prepareRow,h=d;return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("table",(0,S.Z)((0,j.Z)({},t()),{className:"table ".concat(n),style:{width:"100%"},children:[(0,o.jsx)("thead",{children:l.map((function(e){return(0,o.jsx)("tr",(0,S.Z)((0,j.Z)({},e.getHeaderGroupProps()),{children:e.headers.map((function(e){return(0,o.jsxs)("th",(0,S.Z)((0,j.Z)({},e.getHeaderProps(e.getSortByToggleProps())),{children:[e.render("Header"),(0,o.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))}))}))}),(0,o.jsx)("tbody",(0,S.Z)((0,j.Z)({},c()),{children:h.map((function(e,r){return u(e),(0,o.jsx)("tr",(0,S.Z)((0,j.Z)({},e.getRowProps()),{children:e.cells.map((function(e){return(0,o.jsx)("td",(0,S.Z)((0,j.Z)({},e.getCellProps()),{children:e.render("Cell")}))}))}))}))}))]}))})}var P=i(8431),D=i(5416),w=i(7841),_=i(9604),C={good:"#5f9c5f",okay:"#f4c265",bad:"#ea7777",disaster:"#ae3d3d",neutral:"#6591c3"};function B(e){var r=e.value,i=e.max,a=e.color,n=void 0===a?C.neutral:a,s=e.label,t=e.showChart;return(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0.8rem"},children:[t&&(0,o.jsx)("div",{style:{width:80},children:(0,o.jsx)("div",{style:{width:"".concat(r/i*100,"%"),height:20,background:n,borderRadius:"999px"}})}),(0,o.jsx)("div",{children:s||r})]})}var k=function(){var e=(0,g.a)(),r=(0,d.useRouter)(),i=(0,y.P)(),s=(0,n.useRef)();(0,n.useEffect)((function(){e||(location.href="/login")}),[e]);var c=(0,n.useState)({}),j=c[0],S=c[1],H=(0,n.useState)((function(){var e=u.battles.find((function(e){return(0,u.getBattleStatus)(e)===u.BattleStatuses.ONGOING}));return e||(e=u.battles.filter((function(e){return(0,u.getBattleStatus)(e)===u.BattleStatuses.FINISHED})).pop()),e})),k=H[0],I=H[1];(0,n.useEffect)((function(){if(r.isReady){var e=r.query.battleId;if(e){var i=u.battles.find((function(r){return r.id===+e}));i&&I(i)}}}),[r.isReady]);var N=(0,n.useState)(!1),T=(N[0],N[1]),z=(0,n.useState)([]),Z=z[0],R=z[1];(0,n.useEffect)((function(){e&&(T(!0),R([]),Promise.all([e.isPro?(0,h.d)(k.levelIds.filter((function(e){return e}))):Promise.resolve([]),s.current?Promise.resolve(s.current):(0,h.wd)({playerId:e.uid})]).then((function(e){var r=(0,a.Z)(e,2),i=r[0],o=r[1];T(!1),s.current=o;var n=k.levelIds.filter((function(e){return e})).map((function(e){var r,a,n,s=i.find((function(r){return e===(null===r||void 0===r?void 0:r.levelId)})),t=o[e]||{};return{targetId:e,codeDiff:t.codeSize-(null===s||void 0===s||null===(r=s.highscore)||void 0===r?void 0:r.codeSize),myHighscore:t,leaderHighscore:null===s||void 0===s?void 0:s.highscore,scoreDiff:(null===s||void 0===s||null===(a=s.highscore)||void 0===a?void 0:a.score)-t.score,leaderProfile:null===s||void 0===s||null===(n=s.highscore)||void 0===n?void 0:n.playerProfile}})),t=0,c=0,l=0,d=0;n.map((function(e){e.codeDiff>t&&(t=e.codeDiff),e.scoreDiff>c&&(c=e.scoreDiff),e.myHighscore.codeSize>l&&(l=e.myHighscore.codeSize),e.myHighscore.score>d&&(d=e.myHighscore.score)})),S({maxCharDiff:t,maxCodeSize:l,maxScore:d,maxScoreDiff:c,charDiffBreakpoints:[~~(t/3),~~(t/3*2)],scoreDiffBreakpoints:[~~(c/3),~~(c/3*2)]}),R(n)})))}),[e?e.uid:"",k.id]);var E=(0,n.useMemo)((function(){var r=[{Header:"Target",accessor:"target"},{Header:"Match",accessor:"match"},{Header:"My Score",accessor:"score",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.score-r.original.myHighscore.score:1:-1}}];return(null===e||void 0===e?void 0:e.isPro)&&(r.push({Header:"Top Score",accessor:"topScore",disableSortBy:!0}),r.push({Header:"Score Diff",accessor:"scoreDiffRender",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.scoreDiff-r.original.scoreDiff:1:-1}})),r.push({Header:"My chars",accessor:"myChars",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.codeSize-r.original.myHighscore.codeSize:1:-1}}),(null===e||void 0===e?void 0:e.isPro)&&(r.push({Header:"Top chars",accessor:"topChars",disableSortBy:!0}),r.push({Header:"Char Diff",accessor:"charDiff",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.match<100?-1:r.original.myHighscore.match<100?1:e.original.codeDiff-r.original.codeDiff:1:-1}}),r.push({Header:"Last played",accessor:"lastPlayed",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.timeInSeconds-r.original.timeInSeconds:1:-1}})),r}),[null===e||void 0===e?void 0:e.isPro]),M=(0,n.useMemo)((function(){return Z.map((function(r){var i,a=r.targetId,n=r.leaderHighscore,s=r.myHighscore,t=r.codeDiff,c=r.scoreDiff,l=r.leaderProfile;return{myHighscore:s,scoreDiff:c,codeDiff:t,target:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 0"},children:[(0,o.jsx)("a",{href:"/play/".concat(a),style:{display:"flex"},children:(0,o.jsx)("img",{src:"https://cssbattle.dev/targets/".concat(a,".png"),width:"50",alt:"",style:{borderRadius:"6px"}})}),(0,o.jsxs)("span",{children:["#",a]})]}),match:100===s.match?"\u2705":s.match?"\ud83d\udd34 ".concat(s.match,"%"):"-",score:s.score?(0,o.jsx)(B,{value:s.score,max:j.maxScore,color:s.score<600?"indianred":void 0,showChart:e.isPro}):"-",topScore:(0,o.jsxs)(m.Stack,{gap:"0.5rem",align:"center",children:[(0,o.jsx)(x.qE,{small:!0,size:"25",url:null===l||void 0===l?void 0:l.avatar,username:null===l||void 0===l?void 0:l.username,userId:null===l||void 0===l?void 0:l.id}),(0,o.jsx)("span",{children:null===n||void 0===n?void 0:n.score})]}),scoreDiffRender:s.score?(0,o.jsx)(B,{value:Math.trunc(100*c)/100,max:j.maxScoreDiff,color:c<j.scoreDiffBreakpoints[0]?C.green:c>j.scoreDiffBreakpoints[1]?C.bad:C.okay,showChart:!0}):"-",myChars:s.score?(0,o.jsx)(B,{label:"{".concat(s.codeSize,"}"),value:s.codeSize,max:j.maxCodeSize,color:100===s.match?void 0:C.disaster,showChart:e.isPro}):"-",topChars:"{".concat(null===n||void 0===n?void 0:n.codeSize,"}"),charDiff:s.score&&100===s.match?(0,o.jsx)(B,{label:"{".concat(t,"}"),value:t,max:j.maxCharDiff,color:t<j.charDiffBreakpoints[0]?C.good:t>j.charDiffBreakpoints[1]?C.bad:C.okay,showChart:!0}):"-",timeInSeconds:null===(i=s.lastUpdated)||void 0===i?void 0:i.seconds,lastPlayed:s.score?"".concat((0,v.VG)(1e3*s.lastUpdated.seconds)," ago"):"-"}}))}),[Z]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t(),{children:[(0,o.jsx)("title",{children:"My Analytics | CSSBattle"},"title"),(0,o.jsx)("meta",{property:"og:title",content:"My Analytics | CSSBattle"},"ogTitle")]}),(0,o.jsx)(P.x,{icon:"stats",title:"Your stats"}),(0,o.jsx)("div",{className:"",children:e&&i?(0,o.jsx)("div",{className:"",children:(0,o.jsxs)(m.VStack,{gap:"1rem",align:"center",children:[(0,o.jsx)("div",{className:"input-container",children:(0,o.jsxs)(p,{className:"width--full",onChange:function(e){var r=parseInt(e.target.value,10);I(0!==r?u.battles.find((function(e){return e.id===r})):{levelIds:u.battles.reduce((function(e,r){return e.concat(r.levelIds)}),[])})},value:k.id,children:[(0,o.jsx)("option",{value:"0",children:"All battles"},"0"),u.battles.map((function(e){return(0,o.jsxs)("option",{value:e.id,children:["Battle #",e.id," - ",e.name]},e.id)}))]})}),Z.length?(0,o.jsx)(D.s,{children:(0,o.jsx)(b,{columns:E,data:M,classes:"my-stats-table",initialState:(null===e||void 0===e?void 0:e.isPro)?{sortBy:[{id:"scoreDiffRender",desc:!0}]}:void 0})}):(0,o.jsx)(f.R,{children:"Crunching your stats..."}),Z.length&&!e.isPro?(0,o.jsx)(D.s,{children:(0,o.jsxs)(m.VStack,{gap:"1.5rem",children:[(0,o.jsxs)(w.x,{mono:!1,weight:500,size:"1",children:["Upgrade to PLUS to get advanced analytics for your targets."," "]}),(0,o.jsxs)(m.HStack,{children:[(0,o.jsx)(l(),{href:"/plus",children:(0,o.jsx)("a",{className:"button button--primary",children:"Upgrade to Plus"})}),(0,o.jsx)("a",{href:"https://cssbattle.dev/blog/advanced-analytics",className:"button",children:(0,o.jsxs)(m.HStack,{gap:"0.25rem",children:["Learn more",(0,o.jsx)(_.J,{name:"link",size:"12",color:"var(--clr-text-light)"})]})})]})]})}):null]})}):null})]})}},3196:function(e){e.exports={innerPageHeader:"InnerPageHeader_innerPageHeader__HSMOC"}},8033:function(e){e.exports={panel:"Panel_panel__1nQxb",panelOnlyBorder:"Panel_panelOnlyBorder__pccxd",panelGlowing:"Panel_panelGlowing__Pj0jn",panelTopFocus:"Panel_panelTopFocus__S4VQe"}}},function(e){e.O(0,[7274,9774,2888,179],(function(){return r=4610,e(e.s=r);var r}));var r=e.O();_N_E=r}]);
//# sourceMappingURL=me-f69e23c6cc170a24.js.map